### 9.1 广告用户曝光与影响率分析
在广告投放过程中，对用户进行多次广告曝光后，用户响应率（比如应用激活、点击等行为）一般都会有所下降. 目前广告平台为了顾及用户体验，普遍做法是对广告曝光次数进行一定限制，也就是对广告进行频次控制。
![image](/pic/impression_rate.png)
- 可以将**广告频控**设置为固定值，比如对于一周内曝光次数大于7次的用户，在进行广告投放时我们会自动将其过滤，不再对其进行广告曝光，这是比较简单的频次控制方法。
- 另外，通过用户对广告不同曝光次数的**响应衰退率**进行频次控。比如，当用户对广告曝光的响应率衰退为第一次的30%时，我们就停止对其进行广告曝光，因为此时用户对广告的响应率已经变得很低了，再对其进行曝光是浪费资源，还可能会引起用户反感。

在广告投放过程中，用户响应率与曝光次数的关系不仅可以用于频次控制，还可以用在**自动出价方面**

假设某游戏产品客户考核的激活成本（KPI）为100元，现在我们准备对某个之前已经曝光过5次的用户再次进行曝光，那么对照表9-1可以知道本次用户激活衰退率为0.5，用户理论响应率为0.0004，利用oCPM出价技术我们可以得到对该用户的出价Pr的计算公式为：

Pr=α×P×KPI×1000
- Pr为某产品订单对应某用户的出价
- P为某产品订单对应某用户的激活率
- KPI为客户对某产品的KPI
- α为不同曝光次数对应的用户衰退率

可以算出本次对该用户的出价Pr=0.5×0.0004×100×1000=20元。所以本次平台对ADX/SSP（广告交易市场）的报价就是20元

### 9.2 广告用户曝光与点击率分析
不同曝光次数下用户点击衰退率的关系与激活类似，都是随着曝光次数的增加，衰退率会逐渐下降，其中前几次曝光下降的程度较大，后面会逐渐趋于平稳。
![image](/pic/click_rate.png)

### 9.3 广告订单消耗与延时性分析
**客户预算**是客户计划放在DSP等需求方平台上的用于广告投放的钱。
- 对于客户来说，肯定是希望自己的钱都能花在自己期望的目标用户或者潜在目标用户身上，最好能用最少的钱得到最多的潜在目标用户（流量）。
- 而对于DSP平台来说，则是希望在能保证达到客户考核KPI的情况下，尽量多消耗客户充值的钱，但同时也不能出现跑超预算的情况，因为大部分客户都不能接受跑超预算这种情况，甚至可能会怀疑是DSP平台有意为之，从而对DSP平台失去信任。
- 所以，广告投放中如何防止超预算投放的问题也是DSP平台需要认真思考的。

作为需求方平台，难免会出现订单消耗跑超预算的情况。因为有时候会出现数据延时的情况，而在广告投放过程中数据延时问题很难控制，往往受很多因素比如**订单的出价（竞赢率）**、**流量爆发**及**系统稳定性**等影响。


要想防止超预算，最直接且简单有效的方法就是**快**。对于DSP来说，具体就是快速收集每个广告服务器上目前的花费数据，得到接近实时的总体花费情况，然后根据需要（例如立即停止广告投放或者调整投放速率等）快速通知竞价模块，控制出价。在实际操作中, **适当减少X%的日预算**（有些客户给定一定的预算金额，但通常会规定每天的投放金额，这就是日预算）作为缓冲；为每个时间区间设定一个**消费上限**，主要是防止流量的突然爆发，以及通过预算控制来在不同时间区间内分摊消耗，从而起到一定的控制预算不超支的效果。

目前主流的实现预算控制的方法分为两大类。
- 修改竞价：出价影响竞价成功的概率（竞赢率），从而影响预算消耗的速度。这个方法的好处是提供了可以直接竞价来达到优化广告投放效果的可能性。坏处是如何精细地控制花费是一个非常难的问题，这牵涉到Bid Landscape的预测，其本身在RTB中也是一个很难的问题。另外，如果publisher或者SSP那边设定了底价（Reserve Price），那么当竞价低于这个底价时，就不可能参与竞价了。
- 使用概率阀门：每次以某个概率参与竞价，这个概率（也称Pacing Rate）可以是一个动态的值，即每次竞价都可以是一个不同的值。好处是Pacing Rate可以直接精细控制预算花费，坏处是控制的效果还是受到上游竞价模块出价的影响。比如当Pacing Rate达到100%时，如果上游竞价模块不给力，那么就无法加快消费了。
- 预算平滑（Budget Smooth）：可以让广告预算在时间维度上的花费更加合理， 使用预算平滑技术可以分别给广告主和广告平台带来以下好处。1）对广告主：避免预算在每天初期耗尽，无法参加后期的流量竞价；帮助触及更多不同的用户；有机会提升转化效果。2）对广告平台：避免竞争都集中在每天的开始，使整个系统更加平稳；为广告主提供更多的选择，优化效果；
  - 目前，预算平滑技术通常应用在两类系统中，**一是广告平台，二是DSP平台**。这两类平台在实现的方法上稍微有些区别。对于广告平台来说，它拥有所有广告主的信息，可以做一些全局的预算评估和资源分配，目的是使整个广告平台更加稳定和公平。在第二高价（GSP）条件下，能够保持系统的竞价次序。对于DSP平台来说，它是代替广告主来竞价的，其本身就可以挑选流量，因此对于效果类DSP平台来说，更需要考虑的是从ROI的角度来为广告主获得更好的投放效果。

#### 9.3.1 Budget Smooth算法
Budget Smooth是一类算法的统称，核心思想是计算广告展现的概率。Budget Smooth算法可以分为按时间维度分段和按流量分组两种。- - 按时间维度分段：将时间分为若干分段，每一段都设定一个最大消费额。如果超过最大消费额，则降低或者停止广告消费速率。
- 按流量分组：将流量分为若干组，每一组有类似的流量属性。不同组的流量可以进行均衡分配。


如果计划消耗与实际消耗有差异，比如，前面某个时间段实际消耗比计划消耗快，那就需要在下一个时间段及时调整计划，以控制实际消耗按我们的计划消耗进行，如图9-9所示。
![image](/pic/time_budget_control.png)

#### 9.3.2 Budget Smooth算法
Budget Smooth的系统设计主要包括两个方面：·如何影响线上的广告机会的挑选；·如何获取更多的数据反馈支持“消耗计划”的制定。
![image](/pic/time_budget_control2.png)
在DSP平台中，预算平滑是控制出价的一个因素，如图9-11所示。它需要结合其他条件共同进行判断，需要预估流量的机会成本和未来的机会成本。

### 9.4 Lookalike聚类分析
Lookalike翻译为中文是相似人群扩展，指利用广告主提供的种子用户数据，通过模型算法在广告平台的用户大数据库中找到和种子用户相似的用户人群的技术。

为什么：因为在实际应用中，由于广告主提供的种子用户群体往往量比较小，若直接进行广告投放，用户覆盖面往往较小，达不到预期的流量覆盖效果。而借助Lookalike技术能够扩大投放覆盖的人群范围，同时保证精准定向效果。

K means 算法实现：在广告投放中，要如何通过K-means聚类的方法来实现Lookalike相似人群扩展呢？其实也很简单，假设现在有某个游戏客户给了我们4个不同的游戏付费人群（种子用户），每个付费人群代表一个游戏产品，希望我们为其进行相似人群扩展。首先我们可以把每个付费人群作为一类（簇），找出每一类的簇中心，然后通过K-means聚类的方法分别找出每一类人群与平台现有产品人群包中最相似的人群包，其中相似性可以用距离进行度量，最后再把每一个最相似的人群包作为每个产品的潜在目标用户进行投放，这就是最简单的Lookalike相似人群扩展的实现方式。

### 9.5 Lookalike技术在广告中的应用
随着数字广告的出现，广告从原来的受众被动接收转变为双向互动，并且广告的效果也变得可跟踪、可量化。随之而来的，广告主对于受众定向也产生了越来越强烈的需求，如何在合适的时间把合适的内容推送到合适的受众面前，成为广告主对广告技术公司的普遍要求。而针对这个普遍要求，如何找到适合广告主品牌定位的某款产品的目标受众，往往成为某次广告营销活动的起点。目前主要有两类主流做法。第一类是直接基于DMP的第三方数据，通过标签选取或LBS等方式为广告主选取目标受众群，这种做法更多依赖于业务人员对业务、产品、市场的了解，有时候业务经验不一定准确，而且通过标签或者LBS筛选出来的人群规模不容易控制，需要反复尝试，最终确定符合某次投放要求的目标人群数量。第二类是基于广告主第一方数据或第二方数据通过Lookalike算法选取目标受众群。这种做法更多依赖于大数据和机器学习算法，对探索新的业务逻辑，例如对于某款新产品的市场推广，并且在暂时没有很多的业务经验积累的场景中比较适用，也更符合大数据营销的发展趋势。

#### 9.5.1 Lookalike的基本流程
广告主会提供他已有的客群名单作为种子用户，这是机器学习的正样本，然后我们将活跃用户（非种子用户）或者历史已经积累了相似的广告负反馈的用户作为负样本，训练一个二分类的模型，利用模型结果对用户池中的所有用户进行打分排序，而高分的TOP用户就是广告主需要的潜在目标用户。对于训练Lookalike的特征和模型算法，不同的公司各有差异，其特征取决于平台拥有哪些数据。

在模型算法上，Facebook和Google对外公布的算法均是一个预测模型，Yahoo发表过几篇论文，详细介绍过它的算法，比如LR、Linear SVM、GBDT等，并提到GBDT的效果比较好。
![image](/pic/lookalike_eg.png)
